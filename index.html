<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±¡æ£‹åœå¦ - éœå¿ƒèª æ„</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ================================================= */
        /* CSS: åŸºç¤èˆ‡å…¨å±€ç¾å­¸å®šç¾© (èˆ‡å‰ä¸€ç‰ˆæœ¬ä¿æŒä¸€è‡´) */
        /* ================================================= */
        :root {
            --color-primary: #5c677d; /* æ·±è—ç° (ä¸»è‰²) */
            --color-secondary: #a3b18a; /* æŸ”å’Œç¶  (è¼”è‰²/èƒŒæ™¯) */
            --color-red: #d64949; /* å…¸é›…ç´… */
            --color-black: #2d3142; /* æ²‰ç©©é»‘ */
            --color-background: #fdfdfd; /* ä¹¾æ·¨ç™½ */
            --color-border: #e0e0e0;
            --font-serif: 'Noto Serif TC', serif; /* å…¸é›…å®‹é«” */
        }

        body { 
            font-family: var(--font-serif);
            background-color: var(--color-background); 
            color: var(--color-primary); 
            padding: 40px; 
            text-align: center; 
            line-height: 1.6;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: #fff; 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* æŸ”å’Œé™°å½± */
        }
        h1 { 
            font-family: var(--font-serif);
            font-size: 2.2em;
            color: var(--color-black); 
            border-bottom: 2px solid var(--color-secondary); 
            padding-bottom: 15px; 
            margin-bottom: 30px; 
        }
        h2 { 
            font-size: 1.4em; 
            color: var(--color-primary); 
            margin-bottom: 15px; 
            font-weight: 700;
        }
        
        /* å€å¡Šæ¨£å¼ */
        #question-area { margin-bottom: 40px; }
        #query { 
            width: 80%; 
            padding: 12px; 
            margin-top: 10px; 
            border-radius: 8px; 
            border: 1px solid var(--color-border); 
            box-sizing: border-box; 
            resize: none; 
            font-size: 1.1em;
            transition: border-color 0.3s;
        }
        #query:focus { border-color: var(--color-secondary); outline: none; }

        /* é¸å–å€å¡Š */
        #selection-area { margin-bottom: 40px; padding: 30px; border: 1px dashed var(--color-border); border-radius: 10px; }
        #chess-pool { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            margin-top: 20px; 
            gap: 8px;
        }

        /* æ£‹å­é¸å–å€çš„æ¨£å¼ (è“‹ä½çš„æ£‹å­) */
        .covered-piece {
            width: 50px;
            height: 50px;
            border: 2px solid var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%; 
            font-size: 0; 
            background-color: var(--color-secondary); /* æŸ”å’Œç¶ è‰²è“‹ä½ */
            transition: all 0.2s ease-in-out;
        }
        .covered-piece:hover { 
            background-color: #bbc7a5; 
            transform: scale(1.05); 
        }
        .covered-piece.selected {
            opacity: 0; /* é¸æ“‡å¾Œéš±è—ï¼Œé”åˆ°ã€Œç¿»é–‹ä¸¦ç§»èµ°ã€çš„æ½”æ·¨æ„Ÿ */
        }
        #selection-prompt { font-size: 1em; color: var(--color-black); margin-top: 15px; }
        #count { color: var(--color-red); font-weight: 700; }
        
        hr { border: 0; border-top: 1px solid var(--color-border); margin: 40px 0; }

        /* ================================================= */
        /* CSS: å¦å±€ä½ˆå±€ (è¦–è¦ºç„¦é») */
        /* ================================================= */
        #divination-layout-container {
            margin-top: 50px;
        }
        #divination-layout {
            position: relative;
            width: 380px; 
            height: 380px;
            margin: 0 auto;
        }
        .piece-container {
            width: 85px; 
            height: 85px;
            position: absolute;
        }
        
        /* åå­—å®šä½ (å¾®èª¿é–“è·ï¼Œè®“ä½ˆå±€æ›´èˆ’å±•) */
        #pos-1 { top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; } 
        #pos-4 { top: 8%; left: 50%; transform: translate(-50%, 0); } 
        #pos-5 { bottom: 8%; left: 50%; transform: translate(-50%, 0); } 
        #pos-2 { top: 50%; left: 8%; transform: translate(0, -50%); } 
        #pos-3 { top: 50%; right: 8%; transform: translate(0, -50%); } 

        /* ---- æ£‹å­æ¨£å¼ (æ¨¡æ“¬åœ“å½¢å¤–è§€å’Œç´…é»‘é¡è‰² - ç²¾ç·»åŒ–) ---- */

        .chess-piece {
            width: 100%;
            height: 100%;
            border-radius: 50%; 
            background-color: var(--color-background); 
            border: 3px solid var(--color-black); /* å¤–é»‘ç’° */
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* è®“æ£‹å­æœ‰ç«‹é«”æ„Ÿ */
        }
        
        /* å…§å±¤åœ“ç’°èˆ‡æ–‡å­— */
        .piece-inner-ring {
            width: 70%; 
            height: 70%;
            border-radius: 50%;
            border: 3px solid; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.4em; /* æ£‹å­æ–‡å­—æ”¾å¤§ï¼Œçªé¡¯ */
            font-weight: 700;
        }

        /* ç´…é»‘æ£‹å­é¡è‰²è¨­å®š */
        .red-piece .piece-inner-ring {
            color: var(--color-red); /* æ–‡å­—å…¸é›…ç´… */
            border-color: var(--color-red); /* å…§ç’°å…¸é›…ç´… */
        }
        .black-piece .piece-inner-ring {
            color: var(--color-black); /* æ–‡å­—æ²‰ç©©é»‘ */
            border-color: var(--color-black); /* å…§ç’°æ²‰ç©©é»‘ */
        }
    </style>
</head>
<body>

<div class="container">
    <h1>â˜¯ï¸ è±¡æ£‹åœå¦ - ç·£èµ·ä¸€å¿µ å±€å®šäº”ä½</h1>

    <div id="question-area">
        <label for="query" style="display: block; margin-bottom: 8px; font-weight: 700;">ğŸ”® è«‹æ‚¨éœå¿ƒèª æ„ï¼Œè¼¸å…¥æ‰€å•ä¹‹äº‹ï¼š</label>
        <textarea id="query" rows="4" cols="50" placeholder="å•é¡Œè«‹ç›¡é‡æ˜ç¢ºï¼Œä»¥åˆ©å åœï¼Œä¾‹å¦‚ï¼šæˆ‘æ¥ä¸‹ä¾†ä¸‰å€‹æœˆçš„äº‹æ¥­ç™¼å±•æœƒå¦‚ä½•ï¼Ÿ"></textarea>
    </div>

    <div id="selection-area">
        <h2>âœ¨ ç¬¬äºŒæ­¥ï¼šæŠ½å–å¤©æ©Ÿ - ä¾åºé»é¸ 5 é¡†è±¡æ£‹</h2>
        <div id="chess-pool">
            </div>
        <p id="selection-prompt">å·²é¸å–ï¼š <span id="count">0</span> / 5 é¡†</p>
    </div>

    <hr>

    <div id="divination-layout-container">
        <h2>ğŸ“œ ç¬¬ä¸‰æ­¥ï¼šå¦å±€å‘ˆç¾ - äº”ä½å®šç›¤</h2>
        <div id="divination-layout">
            <div id="pos-4" class="piece-container top"></div>
            <div id="pos-2" class="piece-container left"></div>
            <div id="pos-1" class="piece-container center"></div>
            <div id="pos-3" class="piece-container right"></div>
            <div id="pos-5" class="piece-container bottom"></div>
        </div>
    </div>
</div>

<script>
    // 1. æ ¸å¿ƒæ•¸æ“šå®šç¾©
    const ALL_CHESS_PIECES = [
        { name: 'å¸¥', color: 'ç´…' }, { name: 'å°‡', color: 'é»‘' },
        { name: 'ä»•', color: 'ç´…' }, { name: 'å£«', color: 'é»‘' },
        { name: 'ä»•', color: 'ç´…' }, { name: 'å£«', color: 'é»‘' },
        { name: 'ç›¸', color: 'ç´…' }, { name: 'è±¡', color: 'é»‘' },
        { name: 'ç›¸', color: 'ç´…' }, { name: 'è±¡', color: 'é»‘' },
        
        { name: 'ä¿¥', color: 'ç´…' }, { name: 'è»Š', color: 'é»‘' },
        { name: 'ä¿¥', color: 'ç´…' }, { name: 'è»Š', color: 'é»‘' },
        
        { name: 'å‚Œ', color: 'ç´…' }, { name: 'é¦¬', color: 'é»‘' }, 
        { name: 'å‚Œ', color: 'ç´…' }, { name: 'é¦¬', color: 'é»‘' },
        
        { name: 'ç‚®', color: 'ç´…' }, { name: 'åŒ…', color: 'é»‘' },
        { name: 'ç‚®', color: 'ç´…' }, { name: 'åŒ…', color: 'é»‘' },
        { name: 'å…µ', color: 'ç´…' }, { name: 'å’', color: 'é»‘' },
        { name: 'å…µ', color: 'ç´…' }, { name: 'å’', color: 'é»‘' },
        { name: 'å…µ', color: 'ç´…' }, { name: 'å’', color: 'é»‘' },
        { name: 'å…µ', color: 'ç´…' }, { biome: 'å’', color: 'é»‘' }, // éŒ¯èª¤ä¿®æ­£ç‚º name: 'å’'
        { name: 'å…µ', color: 'ç´…' }, { name: 'å’', color: 'é»‘' }
    ];

    let selectedPieces = [];

    const POSITION_MAP = {
        1: 'pos-1', 
        2: 'pos-2', 
        3: 'pos-3', 
        4: 'pos-4', 
        5: 'pos-5'  
    };
    
    document.addEventListener('DOMContentLoaded', () => {
        let piecesToSelect = shuffleArray(ALL_CHESS_PIECES.map((piece, index) => ({ ...piece, id: index })));
        
        const chessPool = document.getElementById('chess-pool');
        piecesToSelect.forEach(piece => {
            const div = document.createElement('div');
            div.className = 'covered-piece';
            div.dataset.id = piece.id;
            div.onclick = () => {
                 const query = document.getElementById('query').value.trim();
                 if (query.length < 5) {
                     alert("è«‹å…ˆè¼¸å…¥ä¸€å€‹æ˜ç¢ºçš„å•é¡Œ (è‡³å°‘ 5 å€‹å­—)ï¼");
                     return;
                 }
                 selectPiece(piece, div);
            };
            chessPool.appendChild(div);
        });
    });

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function selectPiece(pieceData, element) {
        if (selectedPieces.length >= 5) {
            return;
        }

        selectedPieces.push(pieceData);
        const sequenceNumber = selectedPieces.length;

        drawPieceOnLayout(pieceData, sequenceNumber);
        
        document.getElementById('count').textContent = sequenceNumber;
        
        element.classList.add('selected');
        
        if (sequenceNumber === 5) {
            setTimeout(() => {
                alert("äº”é¡†è±¡æ£‹å·²é¸å–å®Œç•¢ï¼Œå¦å±€å·²å®šã€‚è«‹åƒç…§å¦è±¡é€²è¡Œè§£æï¼");
            }, 300);
        }
    }

    function createPieceElement(pieceData) {
        const pieceElement = document.createElement('div');
        const colorClass = (pieceData.color === 'ç´…') ? 'red-piece' : 'black-piece';
        
        pieceElement.className = `chess-piece ${colorClass}`;

        const innerRing = document.createElement('div');
        innerRing.className = 'piece-inner-ring';
        innerRing.textContent = pieceData.name;

        pieceElement.appendChild(innerRing);
        return pieceElement;
    }

    function drawPieceOnLayout(pieceData, sequenceNumber) {
        const containerId = POSITION_MAP[sequenceNumber];
        const container = document.getElementById(containerId);
        
        const pieceElement = createPieceElement(pieceData);

        container.innerHTML = '';
        container.appendChild(pieceElement);
    }
</script>
</body>
</html>